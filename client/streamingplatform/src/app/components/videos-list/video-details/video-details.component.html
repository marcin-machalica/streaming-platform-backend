<div class="page-content">
  <mat-video *ngIf="videoDetails.videoDto.id"
             [autoplay]="true" [download]="true"
             src="{{videoResourceUrl(videoDetails.videoDto.id)}}"></mat-video>
  <mat-video *ngIf="!videoDetails.videoDto.id"></mat-video>
  <h2>{{videoDetails.videoDto.title}}</h2>
  <strong>{{videoDetails.videoDto.author.username}}</strong>
  <p>Description: {{videoDetails.videoDto.description}}</p>
  <p>Views: {{videoDetails.videoRatingDto.viewCount}}</p>
  <p>Up votes: {{videoDetails.videoRatingDto.upVoteCount}}</p>
  <p>Down votes: {{videoDetails.videoRatingDto.downVoteCount}}</p>

  <h3>Comments:</h3>
  <div id="comment_form_0">
    <mat-form-field>
      <textarea matInput required placeholder="Comment" id="comment_input_0"></textarea>
    </mat-form-field>
    <button mat-button (click)="saveComment(null)">
      <span>Comment</span>
    </button>
  </div>

  <mat-tree [dataSource]="dataSource" [treeControl]="treeControl">
    <!-- This is the tree node template for leaf nodes -->
    <mat-tree-node *matTreeNodeDef="let node" matTreeNodePadding>
      <!-- use a disabled button to provide padding for tree leaf -->
      <div>
        <button mat-button disabled></button>
        <p>{{node.author.username}} {{node.dateCreated}} {{node.wasEdited ? '(edited)' : ''}}</p>
        <p [class.italic]="node.isDeleted">{{node.isDeleted ? 'Deleted' : node.message}}</p>

        <div>
          <button mat-button [class.rating-active]="node.currentUserCommentRating.isUpVote" (click)="upVoteComment(node.id)">
            <mat-icon>thumb_up</mat-icon>
            <span>{{node.upVoteCount}}</span>
          </button>
          <button mat-button [class.rating-active]="node.currentUserCommentRating.isdownVote" (click)="downVoteComment(node.id)">
            <mat-icon>thumb_down</mat-icon>
            <span>{{node.downVoteCount}}</span>
          </button>
          <button mat-icon-button [class.rating-active]="node.currentUserCommentRating.isFavourite" (click)="favouriteComment(node.id)">
            <mat-icon>favorite</mat-icon>
          </button>
        </div>

        <div>
          <button mat-button *ngIf="isOwner(node.author.id) && !node.isDeleted" (click)="deleteComment(node)">
            <span>Delete</span>
          </button>
          <button mat-button (click)="setReplyActive(node)">
            <span>Reply</span>
          </button>
          <button mat-button *ngIf="isOwner(node.author.id) && !node.isDeleted" (click)="setEditActive(node)">
            <span>Edit</span>
          </button>
        </div>
        <div *ngIf="node.isReplyActive && !node.isEditActive">
          <mat-form-field>
            <textarea matInput required placeholder="Comment" id="comment_input_{{node.id}}"></textarea>
          </mat-form-field>
          <button mat-button (click)="saveComment(node)">
            <span>Comment</span>
          </button>
          <button mat-button (click)="cancelReplyAndEdit(node)">
            <span>Cancel</span>
          </button>
        </div>
        <div *ngIf="!node.isReplyActive && node.isEditActive">
          <mat-form-field>
            <textarea matInput required placeholder="Comment" id="comment_input_{{node.id}}"></textarea>
          </mat-form-field>
          <button mat-button (click)="updateComment(node)">
            <span>Save</span>
          </button>
          <button mat-button (click)="cancelReplyAndEdit(node)">
            <span>Cancel</span>
          </button>
        </div>
      </div>
    </mat-tree-node>

    <!-- This is the tree node template for expandable nodes -->
    <mat-tree-node *matTreeNodeDef="let node; when: hasChild" matTreeNodePadding>
      <div>
        <p>{{node.author.username}} {{node.dateCreated}} {{node.wasEdited ? '(edited)' : ''}}</p>
        <p [class.italic]="node.isDeleted">{{node.isDeleted ? 'Deleted' : node.message}}</p>

        <div>
          <button mat-button [class.rating-active]="node.currentUserCommentRating.isUpVote" (click)="upVoteComment(node.id)">
            <mat-icon>thumb_up</mat-icon>
            <span>{{node.upVoteCount}}</span>
          </button>
          <button mat-button [class.rating-active]="node.currentUserCommentRating.isdownVote" (click)="downVoteComment(node.id)">
            <mat-icon>thumb_down</mat-icon>
            <span>{{node.downVoteCount}}</span>
          </button>
          <button mat-icon-button [class.rating-active]="node.currentUserCommentRating.isFavourite" (click)="favouriteComment(node.id)">
            <mat-icon>favorite</mat-icon>
          </button>
        </div>

        <div>
          <button mat-button *ngIf="isOwner(node.author.id) && !node.isDeleted" (click)="deleteComment(node)">
            <span>Delete</span>
          </button>
          <button mat-button (click)="setReplyActive(node)">
            <span>Reply</span>
          </button>
          <button mat-button *ngIf="isOwner(node.author.id)" (click)="setEditActive(node)">
            <span>Edit</span>
          </button>
          <button mat-button matTreeNodeToggle>
            <span>{{treeControl.isExpanded(node) ? 'Hide' : ('Show more (' + node.allRepliesCount + ')')}}</span>
          </button>
        </div>

        <div *ngIf="node.isReplyActive && !node.isEditActive">
          <mat-form-field>
            <textarea matInput required placeholder="Comment" id="comment_input_{{node.id}}"></textarea>
          </mat-form-field>
          <button mat-button (click)="saveComment(node)">
            <span>Comment</span>
          </button>
          <button mat-button (click)="cancelReplyAndEdit(node)">
            <span>Cancel</span>
          </button>
        </div>
        <div *ngIf="!node.isReplyActive && node.isEditActive">
          <mat-form-field>
            <textarea matInput required placeholder="Comment" id="comment_input_{{node.id}}"></textarea>
          </mat-form-field>
          <button mat-button (click)="updateComment(node)">
            <span>Save</span>
          </button>
          <button mat-button (click)="cancelReplyAndEdit(node)">
            <span>Cancel</span>
          </button>
        </div>
      </div>
    </mat-tree-node>
  </mat-tree>
</div>
